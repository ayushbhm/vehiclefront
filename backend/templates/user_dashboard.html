{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">ðŸ‘¤ Welcome, {{ current_user.username }}!</h2>

<div class="row mb-4">
  <!-- Active Reservations Card -->
  <div class="col-md-4">
    <div class="card text-white bg-primary mb-3 shadow-sm">
      <div class="card-body text-center">
        <h5 class="card-title">Active Reservations</h5>
        <p class="card-text fs-3 fw-bold">{{ active_count }}</p>
      </div>
    </div>
  </div>
  <!-- Total History Card -->
  <div class="col-md-4">
    <div class="card text-white bg-success mb-3 shadow-sm">
      <div class="card-body text-center">
        <h5 class="card-title">Total History</h5>
        <p class="card-text fs-3 fw-bold">{{ history_count }}</p>
      </div>
    </div>
  </div>
  <!-- Total Cost Card -->
  <div class="col-md-4">
    <div class="card text-white bg-warning mb-3 shadow-sm">
      <div class="card-body text-center">
        <h5 class="card-title">Total Spent (â‚¹)</h5>
        <p class="card-text fs-3 fw-bold">â‚¹{{ total_cost }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="d-flex flex-wrap gap-3 mb-4">
  <a href="{{ url_for('user_lots') }}" class="btn btn-success btn-lg">
    âž• Book a Spot
  </a>
  <a href="{{ url_for('user_reservations') }}" class="btn btn-primary btn-lg">
    ðŸš™ View My Reservations
  </a>
  <a href="{{ url_for('user_history') }}" class="btn btn-info btn-lg">
    ðŸ“œ View History
  </a>
</div>

<h4 class="mt-4">ðŸ“Œ Recent Reservations</h4>
<div class="table-responsive mb-4">
  <table class="table table-striped align-middle">
    <thead class="table-dark">
      <tr>
        <th>Spot ID</th>
        <th>Lot Name</th>
        <th>Start</th>
        <th>End</th>
        <th>Cost (â‚¹)</th>
      </tr>
    </thead>
    <tbody>
      {% for r in recent_reservations %}
      <tr>
        <td>{{ r.spot_id }}</td>
        <td>{{ r.spot.lot.prime_location_name }}</td>
        <td>{{ r.parking_timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>
          {% if r.leaving_timestamp %}
            {{ r.leaving_timestamp.strftime('%Y-%m-%d %H:%M') }}
          {% else %}
            <span class="badge bg-warning">Active</span>
          {% endif %}
        </td>
        <td>{{ r.cost or '-' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


<!-- Optional chart for visual summary -->
<div class="card shadow-sm">
  <div class="card-body">
    <h5 class="card-title mb-3">ðŸ“Š Day-wise Booking Duration (hours)</h5>
    <canvas id="userChart" width="400" height="200"></canvas>
  </div>
</div>

{% block scripts %}
<script>
const chartLabels = {{ chart_labels|tojson }};
const chartData = {{ chart_data|tojson }};

new Chart(document.getElementById('userChart').getContext('2d'), {
  type: 'bar',
  data: {
    labels: chartLabels,
    datasets: [{
      label: 'Hours booked',
      data: chartData,
      backgroundColor: '#0d6efd'
    }]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true,
        title: { display: true, text: 'Hours' }
      },
      x: {
        title: { display: true, text: 'Date' }
      }
    }
  }
});
</script>
{% endblock %}


{% endblock %}
